(function(){var $$=this,$=this.IntelliFactory.Runtime,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;$.Define($$,{"":{BingView:{EnsureMap:function(){var F,G,H,I,J,L,M;F=a("#route_map");if(F.length===0){G=a("#route_ph");H=d.Div(e.ofArray([d.Id("route_map")]));I=G.replaceWith(H.Body);J=function(K){K;};J(I);L=new f.Maps.Map(H.Body,h.MapOptions());i.map=function(){return L;};i.map().setMapType(f.Maps.MapTypeId.road);M=function(){var O;O=new f.Maps.Directions.DirectionsManager(i.map());i.dirMgr=function(){return O;};};return f.Maps.loadModule("Microsoft.Maps.Directions",{callback:M});}else{return null;}},MapOptions:$.Field(function(){var P;P=[{}];P[0].credentials=i.credentials();P[0].width=400;P[0].height=400;return P[0];}),ShowRoute:function(Q){var R,S,T,X,Y;if(!j.Equals(i.dirMgr(),null)){i.dirMgr().resetDirections();R=(S=(T=function(U){var V;return new f.Maps.Directions.Waypoint((V=[{}],(null,V[0].location=new f.Maps.Location(U.Lat,U.Lon),V[0])));},function(W){return e.map(T,W);}),S(Q));X=(Y=function(Z){return i.dirMgr().addWaypoint(Z);},function(_0){return k.iter(Y,_0);});X(R);return i.dirMgr().calculateDirections();}else{return l.Popup("Map not yet ready");}},State:{credentials:$.Field(function(){return"Ah7f3rj-5hx-JvQEBWklc7NHwman6oJ4Ug8BqASMyvexSWbuL5IWT1qnxa0Ew9eB";}),dirMgr:$.Field(function(){return null;}),map:$.Field(function(){return null;})}},OrdersPage:{Attach:function(){var _2,_3;a("#routes_button").on("click",function(_1){return n.validateAndRoute(_1);});_2=a("#orders_page");_3=function(){return m.LoadOrders();};return _2.on("pageshow",_3);},LoadOrders:function(){var _5,_6,_7,bl;_5=a("#orders_ph");if(_5.length>0){_6=(_7=function(){var _9,_;_9=o.Async("Website:0",["48126"]);_=function(ba){var bb,bc,bd,bf,bg,bi,bj;bb=p.CreateList(ba);bc=_5.replaceWith(bb.Body);bd=function(be){be;};bd(bc);bf=a(bb.Body);bg=function(bh){return bh.listview();};bg(bf);bi=a(bb.Body).find("input[type=checkbox]");bj=function(bk){return bk.checkboxradio();};bj(bi);return q.Return(null);};return q.Bind(_9,_);},q.Delay(_7));bl=function(bm){var bn;bn={$:0};return q.Start(bm);};return bl(_6);}else{return null;}},OrderController:{validateAndRoute:function(){var bo,bp,bq,br;bo=a("input[type=checkbox]").filter(":checked").toArray();if(bo.length===0){l.Popup("No orders selected");}else{bp=a("#route_page");bq=(br=a.mobile,function(bs){return br.changePage(bs);});bq(bp);}return true;}},OrderView:{CreateList:function(bt){return r.add(d.UL(e.ofArray([((p.data())("role"))("listview"),((p.data())("theme"))("d")])),k.delay(function(){var bA,bB;return k.collect($.Tupled(function(bv){var bw,bx,by;bw=bv[1];bx=bv[0];by=e.ofArray(["#B5DAFF","#FFDAB4"]).get_Item(bx%2);return k.append([p.OrderHeader(bw,by)],k.delay(function(){return p.OrderItems(bw,by);}));}),(bA=(bB=function(bC){return function(bD){return[bC,bD];};},function(bE){return e.mapi(bB,bE);}),bA(bt)));}));},OrderHeader:function(bF,bG){var bH,bI,bJ,bK,bL,bM;return r.add(d.LI(e.ofArray([(bH="background:"+bG,(bI=d.Attr(),bI.NewAttr("style",bH)))])),e.ofArray([r.add((bJ=e.ofArray([((p.data())("corners"))("false")]),(bK=d.Tags(),bK.NewTag("label",bJ))),e.ofArray([d.Input(e.ofArray([(bL=d.Attr(),bL.NewAttr("type","checkbox")),(bM=bF.Id,d.Attr().NewAttr("order_id",bM))])),d.Text(bF.Addr)]))]));},OrderItems:function(bN,bO){return k.delay(function(){return k.map(function(bQ){var bR,bS,bT,bU,bV,bW,bX;return r.add(d.LI(e.ofArray([(bR="background:"+bO,(bS=d.Attr(),bS.NewAttr("style",bR)))])),e.ofArray([d.Img(e.ofArray([(bT="flowers2/"+bQ.FileName,(bU=d.Attr(),bU.NewAttr("src",bT)))])),d.Span(e.ofArray([(bV=e.ofArray([d.Text(bQ.Name)]),(bW=d.Tags(),bW.NewTag("strong",bV)))])),r.add(d.Span(e.ofArray([d.Attr().Class("ui-li-count")])),e.ofArray([(bX=$$.String(bQ.Quantity),d.Text(bX))]))]));},bN.Items);});},data:$.Field(function(){return function(bY){return function(bZ){var b0,b1;b0=s.Attr();b1="data-"+bY;return b0.NewAttr(b1,bZ);};};})}},Path:{Calc:{calcDist:function(b2,b3,b4,b5){var b6,b7,b8,b9,b_;b6=(90-b2)*0.017453293;b7=(90-b4)*0.017453293;b8=b3*0.017453293;b9=b5*0.017453293;b_=3958.75*t.acos(t.sin(b6)*t.sin(b7)*t.cos(b8-b9)+t.cos(b6)*t.cos(b7));return b_;},shortestPath:function(b$){var ca,cq,cr,ct,cu,cv,cw,cx,cC,cD,cU,cW,cX,cY,cZ,di,dj;ca=k.toList(k.delay(function(){return k.collect(function(cc){return k.collect(function(cd){var ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co;ce=b$[cc];cf=ce[0];cg=ce[1];ch=b$[cd];ci=ch[0];cj=ch[1];ck=(cl=cg[0],(cm=cg[1],(cn=cj[0],(co=cj[1],v.calcDist(cl,cm,cn,co)))));return k.append([[cf,[ci,ck]]],k.delay(function(){return[[ci,[cf,ck]]];}));},w.range(cc+1,b$.length-1));},w.range(0,b$.length-1));}));cq=(cr=function(cs){return y.OfArray(cs);},cr(b$));ct=(cu=(cv=(cw=(cx=$.Tupled(function(cy){var cz,cA;cz=cy[0];cA=cy[1];return cz;}),function(cB){return k.groupBy(cx,cB);}),cw(ca)),(cC=(cD=$.Tupled(function(cE){var cF,cG,cH,cI,cJ,cK,cN,cP,cQ;cF=cE[0];cG=cE[1];return[cF,(cH=(cI=(cJ=(cK=$.Tupled(function(cL){return cL[1];}),function(cM){return k.map(cK,cM);}),cJ(cG)),(cN=function(cO){return k.toArray(cO);},cN(cI))),(cP=(cQ=$.Tupled(function(cR){return cR[1];}),function(cS){return z.sortBy(cQ,cS);}),cP(cH)))];}),function(cT){return k.map(cD,cT);}),cC(cv))),(cU=function(cV){return y.OfArray(k.toArray(cV));},cU(cu)));cW=(cX=e.ofArray([b$[0][0]]),(cY=A.New(cX),(cZ=function(c0,c1){var c2,c3,c4,c5,c6,db;if(c0.$==1){c2=c0.$0;c3=ct.get_Item(c2);c4=(c5=(c6=$.Tupled(function(c7){var c8,c9,c_;c8=c7[0];c9=c7[1];if(c_=function(c$){return c$.Contains(c8);},c_(c1)){return{$:0};}else{return{$:1,$0:c8};}}),function(da){return k.tryPick(c6,da);}),c5(c3));db=function(dc){var dd,df,dg;if(dc.$==0){dd=function(de){return e.rev(de);};return dd(c0);}else{df=dc.$0;return cZ($.New(B,{$:1,$0:df,$1:c0}),(dg=function(dh){return dh.Add(df);},dg(c1)));}};return db(c4);}else{return w.Raise(new C("C:\\Users\\Fai\\Documents\\Visual Studio 2012\\Projects\\MobiFLW\\MobiFLW\\Website\\PathCalc.fs"+" at "+49+":"+24));}},cZ(cX,cY))));di=(dj=function(dk){return[dk,cq.get_Item(dk)];},function(dl){return e.map(dj,dl);});return di(cW);}}},RoutePage:{Attach:function(){var dm,dn;dm=a("#route_page");dn=function(){return D.StartRoute();};return dm.on("pageshow",dn);},GetLoc:function(){var dp;dp=$.Tupled(function(dq){var dr,ds,dt;dr=dq[0];ds=dq[1];dt=dq[2];l.Popup("Getting location...");return E.navigator.geolocation.getCurrentPosition(function(du){l.ClosePopup();return dr(du);});});return q.FromContinuations(function(dv){return function(dw){return dp([dv,dw,function(dx){dx;}]);};});},StartRoute:function(){var dy,dz,dA,dB,dE,dF,dT;h.EnsureMap();dy=(dz=a("input[type=checkbox]").filter(":checked").toArray(),(dA=(dB=function(dC){return dC.getAttribute("order_id");},function(dD){return z.map(dB,dD);}),dA(dz)));dE=(dF=function(){var dH,dI;dH=l.op_LessBarBarGreater(D.GetLoc(),o.Async("Website:1",[dy]));dI=$.Tupled(function(dJ){var dK,dL,dM,dN,dO,dP,dR;dK=dJ[1];dL=dJ[0];dM={Addr:"Start",Lat:dL.coords.latitude,Lon:dL.coords.longitude};dN=(dO=$.New(B,{$:1,$0:dM,$1:dK}),(dP=function(dQ){return D.shortestPath(dQ);},dP(dO)));dR=function(dS){return h.ShowRoute(dS);};dR(dN);return q.Return(null);});return q.Bind(dH,dI);},q.Delay(dF));dT=function(dU){var dV;dV={$:0};return q.Start(dU);};return dT(dE);},shortestPath:function(dW){var dX,dY,dZ,d0,d1,d4,d6,d8,d9;dX=(dY=(dZ=(d0=(d1=function(d2){return[d2.Addr,[d2.Lat,d2.Lon]];},function(d3){return e.map(d1,d3);}),d0(dW)),(d4=function(d5){return z.ofSeq(d5);},d4(dZ))),(d6=function(d7){return v.shortestPath(d7);},d6(dY)));d8=(d9=$.Tupled(function(d_){var d$,ea,eb,ec;d$=d_[0];ea=d_[1];eb=ea[1];ec=ea[0];return{Addr:d$,Lat:ec,Lon:eb};}),function(ed){return e.map(d9,ed);});return d8(dX);}},SiteCommon:{ClosePopup:function(){var ee,ef;ee=a("#message_popup");ef=function(eg){return eg.popup("close");};return ef(ee);},Popup:function(eh){var ei,ej,ek,el,em,eo,eq,es,et,ev;ei=a("#message_popup");if(ei.length===0){ej=(ek=r.add(d.Div(e.ofArray([d.Id("message_popup"),(el=d.Attr(),el.NewAttr("style","padding:10px"))])),e.ofArray([r.add(d.Div(e.ofArray([d.Id("popup_msg")])),e.ofArray([d.Text(eh)]))])).Body,(em=function(en){return a(en);},em(ek)));eo=function(ep){return ep.popup();};eo(ej);eq=function(er){return er.popup("open");};return eq(ej);}else{es=ei.find("#popup_msg").text(eh);et=function(eu){eu;};et(es);ev=function(ew){return ew.popup("open");};return ev(ei);}},op_LessBarBarGreater:function(ex,ey){var ez;ez=function(){var eB,eC,eD;eB=(eC={$:0},q.StartChild(ex));eD=function(eE){var eF,eG,eH;eF=(eG={$:0},q.StartChild(ey));eH=function(eI){var eJ;eJ=function(eK){var eL;eL=function(eM){var eN;eN=[eK,eM];return q.Return(eN);};return q.Bind(eI,eL);};return q.Bind(eE,eJ);};return q.Bind(eF,eH);};return q.Bind(eB,eD);};return q.Delay(ez);}}},MobiFLW:{RootControl:$.Class({get_Body:function(){var eO,eP,eQ;eO=d.Div($.New(B,{$:0}));eP=(eQ=function(){m.Attach();m.LoadOrders();return D.Attach();},function(eS){return r.OnAfterRender(eQ,eS);});eP(eO);return eO;}})}});$.OnInit(function(){a=$.Safe($$.jQuery);b=$.Safe($$.IntelliFactory.WebSharper);c=$.Safe(b.Html);d=$.Safe(c.Default);e=$.Safe(b.List);f=$.Safe($$.Microsoft);g=$.Safe($$[""]);h=$.Safe(g.BingView);i=$.Safe(h.State);j=$.Safe(b.Unchecked);k=$.Safe(b.Seq);l=$.Safe(g.SiteCommon);m=$.Safe(g.OrdersPage);n=$.Safe(m.OrderController);o=$.Safe(b.Remoting);p=$.Safe(m.OrderView);q=$.Safe(b.Concurrency);r=$.Safe(c.Operators);s=$.Safe(d.HTML5);t=$.Safe($$.Math);u=$.Safe(g.Path);v=$.Safe(u.Calc);w=$.Safe(b.Operators);x=$.Safe(b.Collections);y=$.Safe(x.MapModule);z=$.Safe(b.Arrays);A=$.Safe(x["FSharpSet`1"]);B=$.Safe(e.T);C=$.Safe($$.Error);D=$.Safe(g.RoutePage);return E=$.Safe($$.window);});$.OnLoad(function(){p.data();i.map();i.dirMgr();i.credentials();h.MapOptions();});}());
